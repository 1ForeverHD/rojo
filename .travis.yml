language: python
env:
  - LUA="lua=5.1"

matrix:
  allow_failures:


matrix:
  include:
    - language: rust
      rust:\n- stable\n- beta\n -nightly
      matrix:
        allow_failures:
          - rust: nightly
      cache: cargo

    # http://kiki.to/blog/2016/02/04/talk-continuous-integration-with-lua/
    - language: python
      env:
        - LUA="lua=5.1"

      before_install:
        - pip install hererocks
        - hererocks lua_install -r^ --$LUA
        - export PATH=$PATH:$PWD/lua_install/bin

      install:
        - luarocks install luafilesystem
        - luarocks install busted
        - luarocks install luacov
        - luarocks install luacov-coveralls
        - luarocks install luacheck

      script:
        - cd plugin && luacheck . && cd ..
        - lua -lluacov spec.lua

      after_success:
        - luacov-coveralls -e $TRAVIS_BUILD_DIR/lua_install